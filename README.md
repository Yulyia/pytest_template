# pytest_template - проверка бизнес-сценариев магазина Petstore

## Описание
Проект представляет собой пример автоматизированных тестов на python.
Пример проекта сделан на основе [openapi контракта Petstore](https://petstore3.swagger.io/)

Автоматизированные тесты проверяют бизнес-сценарии и базовые функции работы бэкенда магазина Petstore. 

## Технологии используемые в проекте
1. Язык программирования - python 3.8.
2. Окружение - pipenv.
3. Управление тестами - pytest.
4. Модуль для отправки запросов - requests.
5. Фреймворк для отчетности - Allure, pytest-html.


## Процесс сборки проекта
Проект не требует сборки

## Использование

### Запуск автотестов локально:

Для запуска локально на ПК необходимо установить:
- python версии 3.8 - https://www.python.org/downloads/
- pip последней версии
- pipenv последней версии
1. Склонировать проект на ПК
2. Перейти в проект. Выполнить комманду pipenv install. После этого шага все необходимые зависимости установятся на ПК.
3.1 Запуск через терминал.
Запустить необходимый тест или все тесты, используя комманды:
- pytest - для запуска всех тестов
- pytest tests/pet_test.py::test_add_pet - для запуска конкретного теста 
- pytest -m <маркер> - для запуска конкретного/ых теста/ов с определённым маркером

Дополнительные маркеры
"--alluredir=./allure-results" - генерация отчёта аллюр
"--junitxml=report.xml" - генерация отчёта в формате xml
"--html=report.html --self-contained-html" - генерация отчёта в формате html

3.2 Запуск в среде разработки.
Открыть IDE (для примера - PyCharm Community), открыть проект, убедиться, что default test runner
установлен в autodetect и определён pytest.
Запустить все тесты, выбрав папку с тестами и нажав правой кнопкой мыши на ран.
Запустить необходимый тест, перейдя в файл, где он расположен


### Запуск в Gitlab CI
1. Открыть Gitlab
2. Перейти в раздел CI/CD - Piplines
3. Выбрать коммит с необходимыми изменениями, нажать Run
4. Дождаться прохождения job
5. Скачать артефакты с отчётами


## Процесс создания нового автотеста
Для создания нового автотеста необходимо перейти в существующий файл с тестами
в случае смыслового совпадения тестов(папка tests, файл с постфиксом _test) или создать новый файл в папке tests
c постфиксом _test. Далее создать функцию, в наименовании которой будет префикс test_ и смысловое 
наименование теста на английском языке. Промаркировать тест в случае необходимости смысловым маркером, добавить 
заголовок аллюр. В теле теста использовать уже существующие методы или создать новые.

## Архитектура
В пакете "tests" расположены тесты, которые состоят из шагов. В случае изменения первоначального состояния стенда при выполнении теста,
после его завершения, тестовые данные возвращаются в исходное состояние.
Каждый тест промаркирован заголовком аллюр.
Шаги расположены в пакете 
"steps". Каждый шаг также промаркирован аллюр-заголовком для понятного отображения в отчёте. 
В шагах могут использоваться параметры из пакета params, в том числе jsonschema.
jsonschema сгенерирована с помощью открытого онлайн источника
"https://www.liquid-technologies.com/online-json-to-schema-converter" и отредактирована руками.